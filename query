SELECT
  mr.region,
  mr.environment,
  t.meeting_id,

  mr.start_time::timestamp AS meeting_started_at,
  mr.end_time::timestamp   AS meeting_ended_at,

  t.transcript_available_at,
  (t.transcript_available_at - mr.end_time::timestamp) AS delay_from_end_to_transcript,

  t.processed,
  t.retry_count
FROM public.transcripts t
JOIN public.meeting_records mr
  ON mr.meeting_id = t.meeting_id
WHERE mr.environment = 'prod'
  AND t.transcript_available_at IS NOT NULL
  AND (t.transcript_available_at - mr.end_time::timestamp) > INTERVAL '10 minutes'
ORDER BY delay_from_end_to_transcript DESC
LIMIT 20;
