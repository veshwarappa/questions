SELECT
  mr.meeting_id,
  mr.region,
  (mr.event_date || ' ' || mr.end_time)::timestamp AS meeting_end_ts,
  t.transcript_available_at,
  ROUND(EXTRACT(EPOCH FROM (t.transcript_available_at - (mr.event_date || ' ' || mr.end_time)::timestamp))/60.0, 2) AS delay_minutes,
  t.retry_count
FROM public.meeting_records mr
JOIN public.transcripts t
  ON t.meeting_id = mr.meeting_id
WHERE mr.environment = 'prod'
  AND mr.region = 'ANZ'
  AND (mr.event_date || ' ' || mr.end_time)::timestamp >= '2026-02-17'::timestamp
  AND (mr.event_date || ' ' || mr.end_time)::timestamp <  '2026-02-18'::timestamp
  AND t.transcript_available_at IS NOT NULL
ORDER BY delay_minutes DESC
LIMIT 100;


SELECT event_date, end_time
FROM public.meeting_records
WHERE environment='prod' AND region='ANZ'
ORDER BY created_at DESC
LIMIT 20;

SELECT
  mr.meeting_id,
  (to_date(mr.event_date,'DD/MM/YYYY')::text || ' ' || mr.end_time)::timestamp AS meeting_end_ts,
  t.transcript_available_at,
  ROUND(EXTRACT(EPOCH FROM (t.transcript_available_at - (to_date(mr.event_date,'DD/MM/YYYY')::text || ' ' || mr.end_time)::timestamp))/60.0, 2) AS delay_minutes
FROM public.meeting_records mr
JOIN public.transcripts t ON t.meeting_id = mr.meeting_id
WHERE mr.environment='prod'
  AND mr.region='ANZ'
  AND (to_date(mr.event_date,'DD/MM/YYYY')::timestamp) >= '2026-02-17'::timestamp
  AND (to_date(mr.event_date,'DD/MM/YYYY')::timestamp) <  '2026-02-18'::timestamp
ORDER BY delay_minutes DESC
LIMIT 100;



SELECT step_name, status, started_at, completed_at, duration_seconds, trace_id
FROM public.pipeline_events
WHERE meeting_record_id = '<MEETING_ID>'
ORDER BY started_at;

