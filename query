SELECT
  ROUND(AVG(EXTRACT(EPOCH FROM (t.transcript_available_at - mr.completed_at))/60.0), 2) AS avg_min,
  ROUND(MIN(EXTRACT(EPOCH FROM (t.transcript_available_at - mr.completed_at))/60.0), 2) AS min_min,
  ROUND(MAX(EXTRACT(EPOCH FROM (t.transcript_available_at - mr.completed_at))/60.0), 2) AS max_min
FROM public.meeting_records mr
JOIN public.transcripts t ON t.meeting_id = mr.meeting_id
WHERE mr.environment = 'prod'
  AND mr.region = 'ANZ'
  AND mr.completed_at >= '2026-02-16'::date
  AND mr.completed_at <  '2026-02-18'::date
  AND t.transcript_available_at IS NOT NULL;


SELECT
  mr.meeting_id,
  mr.payload_submitted_at,
  t.transcript_available_at,
  ROUND(EXTRACT(EPOCH FROM (t.transcript_available_at - mr.payload_submitted_at))/60.0, 2) AS delay_minutes,
  t.retry_count
FROM public.meeting_records mr
JOIN public.transcripts t ON t.meeting_id = mr.meeting_id
WHERE mr.environment = 'prod'
  AND mr.region = 'ANZ'
  AND mr.payload_submitted_at >= '2026-02-16'::date
  AND mr.payload_submitted_at <  '2026-02-18'::date
  AND t.transcript_available_at IS NOT NULL
ORDER BY delay_minutes DESC
LIMIT 50;




SELECT meeting_id, created_at, payload_submitted_at, completed_at, event_date, end_time
FROM public.meeting_records
WHERE environment='prod'
  AND region='ANZ'
ORDER BY completed_at DESC
LIMIT 5;


