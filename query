SELECT
    mr.interview_id,

    -- meeting_records
    mr.start_time               AS mr_start_time,
    mr.end_time                 AS mr_end_time,
    mr.event_date,
    mr.created_at               AS mr_created_at,
    mr.completed_at             AS mr_completed_at,
    mr.payload_submitted_at,

    -- transcripts
    t.start_time                AS transcript_start_time,
    t.end_time                  AS transcript_end_time,
    t.start_date,
    t.meeting_date,
    t.interview_date,
    t.created_at                AS transcript_created_at,
    t.last_checked_at,
    t.transcript_available_at,

    -- pipeline_events
    pe.step_name,
    pe.started_at               AS step_started_at,
    pe.completed_at             AS step_completed_at

FROM public.meeting_records mr

LEFT JOIN public.transcripts t
    ON mr.interview_id = t.interview_id

LEFT JOIN public.pipeline_events pe
    ON mr.meeting_id = pe.meeting_record_id

WHERE mr.interview_id = '5062549'
ORDER BY pe.started_at;




SELECT
    mr.meeting_id,
    mr.interview_id,
    mr.completed_at AS meeting_completed_at,
    t.transcript_available_at,
    EXTRACT(EPOCH FROM 
        (t.transcript_available_at - mr.completed_at)
    ) / 60 AS minutes_between_meeting_and_transcript
FROM public.meeting_records mr
LEFT JOIN public.transcripts t
    ON mr.interview_id = t.interview_id
WHERE mr.interview_id = '5143669';


SELECT
    mr.completed_at AT TIME ZONE 'Australia/Sydney' AS meeting_completed_sydney,
    mr.payload_submitted_at AT TIME ZONE 'Australia/Sydney' AS payload_received_sydney,
    pe.started_at AT TIME ZONE 'Australia/Sydney' AS pipeline_started_sydney,
    t.transcript_available_at AT TIME ZONE 'Australia/Sydney' AS transcript_available_sydney,
    
    EXTRACT(EPOCH FROM (mr.payload_submitted_at - mr.completed_at)) / 60 AS mins_meeting_to_payload,
    EXTRACT(EPOCH FROM (pe.started_at - mr.payload_submitted_at)) / 60 AS mins_payload_to_processing,
    EXTRACT(EPOCH FROM (t.transcript_available_at - mr.completed_at)) / 60 AS total_minutes_meeting_to_transcript

FROM meeting_records mr
LEFT JOIN transcripts t ON mr.interview_id = t.interview_id
LEFT JOIN pipeline_events pe ON mr.meeting_id = pe.meeting_record_id
WHERE mr.interview_id = '5143669'
ORDER BY pe.started_at
LIMIT 1;

