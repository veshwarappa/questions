SELECT
  mr.region,
  COUNT(*) AS meetings_count,
  ROUND(
    AVG(EXTRACT(EPOCH FROM (t.transcript_available_at - t.created_at)) / 60.0),
    2
  ) AS avg_generation_minutes,
  ROUND(
    MAX(EXTRACT(EPOCH FROM (t.transcript_available_at - t.created_at)) / 60.0),
    2
  ) AS max_generation_minutes
FROM public.transcripts t
JOIN public.meeting_records mr
  ON mr.meeting_id = t.meeting_id
WHERE t.transcript_available_at IS NOT NULL
  AND t.created_at IS NOT NULL
  AND t.transcript_available_at >= NOW() - INTERVAL '7 days'
GROUP BY mr.region
ORDER BY avg_generation_minutes DESC;


SELECT
  COUNT(*) AS meetings_count,
  ROUND(
    AVG(EXTRACT(EPOCH FROM (t.transcript_available_at - t.created_at)) / 60.0),
    2
  ) AS avg_generation_minutes,
  ROUND(
    MAX(EXTRACT(EPOCH FROM (t.transcript_available_at - t.created_at)) / 60.0),
    2
  ) AS max_generation_minutes
FROM public.transcripts t
WHERE t.transcript_available_at IS NOT NULL
  AND t.created_at IS NOT NULL
  AND t.transcript_available_at >= NOW() - INTERVAL '7 days';


SELECT
  mr.region,
  t.meeting_id,
  t.created_at AS transcript_row_created_at,
  t.transcript_available_at,
  ROUND(EXTRACT(EPOCH FROM (t.transcript_available_at - t.created_at)) / 60.0, 2)
    AS generation_minutes,
  t.processed,
  t.retry_count
FROM public.transcripts t
JOIN public.meeting_records mr
  ON mr.meeting_id = t.meeting_id
WHERE t.transcript_available_at IS NOT NULL
  AND t.created_at IS NOT NULL
  AND t.transcript_available_at >= NOW() - INTERVAL '7 days'
ORDER BY generation_minutes DESC
LIMIT 20;

