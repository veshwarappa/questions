SELECT mr.meeting_id,
       mr.region,
       mr.created_at,
       t.transcript_available_at,
       t.retry_count
FROM public.meeting_records mr
JOIN public.transcripts t
  ON mr.meeting_id = t.meeting_id
WHERE mr.environment = 'prod'
  AND mr.region = 'ANZ'
  AND t.transcript_available_at >= '2026-02-17'::date
  AND t.transcript_available_at <  '2026-02-18'::date
ORDER BY t.transcript_available_at;


SELECT mr.meeting_id,
       mr.region,
       (mr.end_time)::timestamp AS end_time,
       t.transcript_available_at,
       EXTRACT(EPOCH FROM (t.transcript_available_at - (mr.end_time)::timestamp))/60 AS delay_minutes,
       t.retry_count
FROM public.meeting_records mr
JOIN public.transcripts t
  ON mr.meeting_id = t.meeting_id
WHERE mr.environment = 'prod'
  AND mr.region = 'ANZ'
  AND t.transcript_available_at >= '2026-02-17'::date
  AND t.transcript_available_at <  '2026-02-18'::date
ORDER BY delay_minutes DESC;


SELECT mr.region,
       ROUND(AVG(EXTRACT(EPOCH FROM (t.transcript_available_at - (mr.end_time)::timestamp))/60),2) AS avg_delay_min,
       COUNT(*) AS total_meetings
FROM public.meeting_records mr
JOIN public.transcripts t
  ON mr.meeting_id = t.meeting_id
WHERE mr.environment = 'prod'
  AND t.transcript_available_at >= '2026-02-17'::date
  AND t.transcript_available_at <  '2026-02-18'::date
GROUP BY mr.region;
