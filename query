SELECT
  mr.meeting_id,
  mr.region,
  (substring(mr.event_date from 1 for 10) || ' ' || mr.end_time)::timestamp AS meeting_end_ts,
  t.transcript_available_at,
  ROUND(EXTRACT(EPOCH FROM (t.transcript_available_at - (substring(mr.event_date from 1 for 10) || ' ' || mr.end_time)::timestamp))/60.0, 2) AS delay_minutes,
  t.retry_count
FROM public.meeting_records mr
JOIN public.transcripts t ON t.meeting_id = mr.meeting_id
WHERE mr.environment = 'prod'
  AND mr.region = 'ANZ'
  AND substring(mr.event_date from 1 for 10) ~ '^\d{4}-\d{2}-\d{2}$'
  AND (substring(mr.event_date from 1 for 10) || ' ' || mr.end_time)::timestamp >= '2026-02-17'::timestamp
  AND (substring(mr.event_date from 1 for 10) || ' ' || mr.end_time)::timestamp <  '2026-02-18'::timestamp
  AND t.transcript_available_at IS NOT NULL
ORDER BY delay_minutes DESC
LIMIT 100;


SELECT event_date
FROM public.meeting_records
WHERE environment='prod'
  AND region='ANZ'
  AND substring(event_date from 1 for 10) !~ '^\d{4}-\d{2}-\d{2}$'
LIMIT 50;


SELECT step_name, status, started_at, completed_at, duration_seconds, trace_id
FROM public.pipeline_events
WHERE meeting_record_id = '<MEETING_ID>'
ORDER BY started_at;
