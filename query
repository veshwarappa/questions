SELECT
  mr.region,
  ROUND(AVG(EXTRACT(EPOCH FROM (
    t.transcript_available_at -
    (substring(t.meeting_date from 1 for 10) || ' ' ||
     substring(t.end_time from 1 for 8))::timestamp
  ))/60.0),2) AS avg_delay_min,
  ROUND(MAX(EXTRACT(EPOCH FROM (
    t.transcript_available_at -
    (substring(t.meeting_date from 1 for 10) || ' ' ||
     substring(t.end_time from 1 for 8))::timestamp
  ))/60.0),2) AS max_delay_min
FROM public.transcripts t
JOIN public.meeting_records mr ON mr.meeting_id = t.meeting_id
WHERE mr.environment='prod'
  AND t.transcript_available_at >= '2026-02-01'::date
  AND t.transcript_available_at <  '2026-02-16'::date
  AND t.transcript_available_at IS NOT NULL
GROUP BY mr.region
ORDER BY max_delay_min DESC;
